---
title: "hw5"
author: "Sherry WeMott"
date: "11/21/2019"
output: html_document
---

```{r, include = FALSE}
# load packages
library(tidyverse)
library(tigris)
library(sf)
```


```{r}

knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, error = FALSE)

# read in data
denver <- read_csv("../data/homicide-data.csv") %>% 
  filter(city == "Denver") %>% 
  select(lat, lon, disposition, victim_race)
```


```{r}
# filter by race
denver_race <- denver %>% 
  group_by(victim_race) %>% 
  mutate(count = n()) %>% 
  arrange(desc(count)) %>% 
  ungroup() %>% 
  filter(victim_race == c("Black", "White", "Hispanic"))  

denver_race
```

```{r}
# create zip code map
denver_zip <- zctas(cb = TRUE, starts_with = 
                      c("802"), class = "sf")
plot(denver_zip)
``` 

```{r}
# categorize into solved and unsolved
denver_disp <- denver_race %>% 
  mutate(disposition = factor(disposition, levels = c("Closed without arrest", 
                                                      "Closed by arrest", 
                                                      "Open/No arrest"),
                              labels = c("solved", "solved", "unsolved")))

``` 

```{r}
# create dataframe of disposition status with geocode
denver_crs <- denver_disp %>% 
  filter(!is.na(lat)) %>% 
  st_as_sf(coords = c("lon", "lat")) %>% 
  st_set_crs(4269)
denver_crs
```
```{r}

# create plot of homicides overlayed on denver map
zip_map <- ggplot() +
  geom_sf(data = denver_zip, color = "lightgray") +
  geom_sf(data = denver_crs, aes(color = factor(victim_race)), 
          show.legend = 'point') +
  facet_wrap(~disposition, ncol =1) +
  ggtitle("Homicide cases in Denver, CO", subtitle = "by zipcode") +
  labs(x = "Longitude", y = "Lattitude") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(colour = "Victim Race")
  
zip_map
```

